"use strict";function showError(a){console.log(a)}function calcBounds(){var a=null;for(var b in layers)a?a.extend(layers[b].getBounds()):a=layers[b].getBounds();a&&map.fitBounds(a)}function removeLayer(a){layers[a]&&(map.removeLayer(layers[a]),delete layers[a])}function addLayer(a){client.readFile(a,function(b,c){if(b)return showError(b);var d=a.substr(0,a.lastIndexOf("/")),e=folders.indexOf(d);-1===e&&(e=folders.push(d)-1);var f=colors[e%colors.length],g=omnivore.gpx.parse(c).bindLabel(a.substr(1),{direction:"auto"});g.setStyle({color:f,opacity:.7}),g.addTo(map),layers[a]=g,calcBounds()})}function poll(){client.pollForChanges(cursorTag,function(a,b){return a?showError(a):void(b.hasChanges?pullChanges():setTimeout(poll,1e3*b.retryAfter))})}function processChanges(a){a.forEach(function(a){".gpx"===a.path.substr(-4)&&(a.wasRemoved?(removeLayer(a.path),calcBounds()):(removeLayer(a.path),addLayer(a.path)))});var b=0;a.shouldBackOff&&(b=5e3),setTimeout(poll,b)}function pullChanges(){client.pullChanges(cursorTag,function(a,b){return a?showError(a):(cursorTag=b.cursorTag,void processChanges(b.changes))})}function run(a){client=a,pullChanges()}var colors=["#e31a1c","#1f78b4","#33a02c","#ff7f00","#6a3d9a","#b15928"],client,cursorTag=null,layers={},folders=[],map;$(function(){if("emenendez.github.io"===window.location.host&&"https:"!==window.location.protocol)return void(window.location.protocol="https");var a=new Dropbox.Client({key:"9a666eiuctz1yh4"}),b=L.latLng(39,-78);map=L.map("map").setView(b,13);var c={"Esri Topo Map":L.tileLayer.provider("Esri.WorldTopoMap"),"Esri Street Map":L.tileLayer.provider("Esri.WorldStreetMap"),OpenStreetMap:L.tileLayer.provider("OpenStreetMap.Mapnik"),"Esri Imagery":L.tileLayer.provider("Esri.WorldImagery"),"MapQuest Imagery":L.tileLayer.provider("MapQuestOpen.Aerial")};for(var d in c){c[d].addTo(map);break}L.control.layers(c).addTo(map),L.control.fullscreen().addTo(map),L.control.coordinates({position:"bottomleft",labelTemplateLat:"Latitude: {y}",labelTemplateLng:"Longitude: {x}",useLatLngOrder:!0}).addTo(map),a.authenticate({interactive:!1},function(a,b){return a?showError(a):void(b.isAuthenticated()?run(b):b.authenticate(function(a,b){return a?showError(a):void run(b)}))})});